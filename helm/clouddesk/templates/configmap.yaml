apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "clouddesk.fullname" . }}-config
  labels:
    {{- include "clouddesk.labels" . | nindent 4 }}
data:
  NODE_ENV: "production"
  PORT: "3000"
  LOG_LEVEL: {{ .Values.logging.level | quote }}
  LOG_FORMAT: {{ .Values.logging.format | quote }}

  # License configuration
  LICENSE_SERVER_URL: {{ .Values.license.serverUrl | quote }}

  # Session worker configuration
  WORKER_IMAGE: "{{ .Values.global.imageRegistry }}{{ .Values.sessionWorker.image.repository }}:{{ .Values.sessionWorker.image.tag }}"
  WORKER_PORT_START: {{ .Values.sessionWorker.portRange.start | quote }}
  WORKER_PORT_END: {{ .Values.sessionWorker.portRange.end | quote }}

  # Frontend URL (for CORS)
  {{- if .Values.ingress.enabled }}
  {{- $host := (index .Values.ingress.hosts 0).host }}
  {{- if .Values.ingress.tls }}
  FRONTEND_URL: "https://{{ $host }}"
  {{- else }}
  FRONTEND_URL: "http://{{ $host }}"
  {{- end }}
  {{- else }}
  FRONTEND_URL: "http://localhost:3000"
  {{- end }}
