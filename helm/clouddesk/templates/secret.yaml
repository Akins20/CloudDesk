apiVersion: v1
kind: Secret
metadata:
  name: {{ include "clouddesk.fullname" . }}-secret
  labels:
    {{- include "clouddesk.labels" . | nindent 4 }}
type: Opaque
stringData:
  # Database connection
  {{- if .Values.mongodb.enabled }}
  MONGODB_URI: {{ include "clouddesk.mongodbUri" . | quote }}
  {{- else }}
  MONGODB_URI: {{ printf "mongodb://%s:%s@%s:%d/%s?authSource=admin" .Values.mongodb.external.username .Values.mongodb.external.password .Values.mongodb.external.host (int .Values.mongodb.external.port) .Values.mongodb.external.database | quote }}
  {{- end }}

  # Redis connection
  REDIS_URL: {{ include "clouddesk.redisUrl" . | quote }}

  # JWT secrets
  {{- if .Values.security.jwtAccessSecret }}
  JWT_ACCESS_SECRET: {{ .Values.security.jwtAccessSecret | quote }}
  {{- else }}
  JWT_ACCESS_SECRET: {{ randAlphaNum 64 | quote }}
  {{- end }}
  {{- if .Values.security.jwtRefreshSecret }}
  JWT_REFRESH_SECRET: {{ .Values.security.jwtRefreshSecret | quote }}
  {{- else }}
  JWT_REFRESH_SECRET: {{ randAlphaNum 64 | quote }}
  {{- end }}

  # Encryption key for credentials
  {{- if .Values.security.encryptionKey }}
  ENCRYPTION_KEY: {{ .Values.security.encryptionKey | quote }}
  {{- else }}
  ENCRYPTION_KEY: {{ randAlphaNum 32 | quote }}
  {{- end }}

  # License key
  {{- if .Values.license.key }}
  LICENSE_KEY: {{ .Values.license.key | quote }}
  {{- end }}
